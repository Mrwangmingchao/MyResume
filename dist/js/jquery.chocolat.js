!function(d){images=[];var s=0;d.fn.Chocolat=function(r){r=d.extend({container:d("body"),displayAsALink:!1,linkImages:!0,linksContainer:"Choco_links_container",overlayOpacity:.9,overlayColor:"#fff",fadeInOverlayduration:500,fadeInImageduration:500,fadeOutImageduration:500,vache:!0,separator1:" | ",separator2:"/",leftImg:"images/left.gif",rightImg:"images/right.gif",closeImg:"images/close.gif",loadingImg:"images/loading.gif",currentImage:0,setIndex:0,setTitle:"",lastImage:0},r),s++,r.setIndex=s,images[r.setIndex]=[],this.each(function(e){0==e&&r.linkImages&&""==r.setTitle&&(r.setTitle=a(d(this).attr("rel")," ")),d(this).each(function(){images[r.setIndex].displayAsALink=r.displayAsALink,images[r.setIndex][e]=[],images[r.setIndex][e].adress=a(d(this).attr("href")," "),images[r.setIndex][e].caption=a(d(this).attr("title")," "),r.displayAsALink||d(this).unbind("click").bind("click",{id:r.setIndex,nom:r.setTitle,i:e},o)})});for(var n=0;n<images[r.setIndex].length;n++)if(images[r.setIndex].displayAsALink)return 0==d("#"+r.linksContainer).size()&&this.filter(":first").before('<ul id="'+r.linksContainer+'"></ul>'),d("#"+r.linksContainer).append('<li><a href="#" id="Choco_numsetIndex_'+r.setIndex+'" class="Choco_link">'+r.setTitle+"</a></li>"),e=this.parent(),d(this).remove(),""==d.trim(e.html())&&e.remove(),d("#Choco_numsetIndex_"+r.setIndex).unbind("click").bind("click",{id:r.setIndex,nom:r.setTitle,i:r.currentImage},o);function o(e){return r.currentImage=e.data.i,r.setIndex=e.data.id,r.setTitle=e.data.nom,r.lastImage=images[r.setIndex].length-1,d("#Choco_overlay").remove(),d("#Choco_content").remove(),r.container.append('<div id="Choco_overlay"></div><div id="Choco_content"><div id="Choco_close"></div><div id="Choco_loading"></div><div id="Choco_container_photo"><img id="Choco_bigImage" src="" /></div><div id="Choco_container_description"><span id="Choco_container_title"></span><span id="Choco_container_via"></span></div><div id="Choco_left_arrow" class="Choco_arrows"></div><div id="Choco_right_arrow" class="Choco_arrows"></div></div>'),d("#Choco_left_arrow").css("background-image","url("+r.leftImg+")"),d("#Choco_right_arrow").css("background-image","url("+r.rightImg+")"),d("#Choco_close").css("background-image","url("+r.closeImg+")"),d("#Choco_loading").css("background-image","url("+r.loadingImg+")"),"body"!==r.container.get(0).nodeName.toLowerCase()&&(r.container.css({position:"relative",overflow:"hidden","line-height":"normal"}),d("#Choco_content").css("position","relative"),d("#Choco_overlay").css("position","absolute")),d(document).unbind("keydown").bind("keydown",function(e){switch(e.keyCode){case 37:t(-1);break;case 39:t(1);break;case 27:c()}}),r.vache&&d("#Choco_overlay").click(function(){return c(),!1}),d("#Choco_left_arrow").unbind().bind("click",function(){return t(-1),!1}),d("#Choco_right_arrow").unbind().bind("click",function(){return t(1),!1}),d("#Choco_close").unbind().bind("click",function(){return c(),!1}),d(window).resize(function(){i(r.currentImage,!0)}),i(r.currentImage,!1),d("#Choco_overlay").css({"background-color":r.overlayColor,opacity:r.overlayOpacity}).fadeIn(r.fadeInOverlayduration),d("#Choco_content").fadeIn(r.fadeInImageduration,function(){}),!1}function i(e,o){r.currentImage=e,d("#Choco_loading").fadeIn(r.fadeInImageduration);var i=new Image;i.onload=function(){d("#Choco_bigImage").attr("src",images[r.setIndex][r.currentImage].adress);var e=function(e,o){var i=d("#Choco_container_description").height()+d("#Choco_close").height(),n=e+i,t=o/e,a=e/o;"body"==r.container.get(0).nodeName.toLowerCase()?(windowHeight=d(window).height(),windowWidth=d(window).width()):(windowHeight=r.container.height(),windowWidth=r.container.width());notFitting=!0;for(;notFitting;){n=e+i;o+28*o/100>windowWidth?(o=100*windowWidth/128,e=a*o):n>windowHeight?(e=windowHeight-i,o=t*e):notFitting=!1}return{largeur:o,hauteur:e}}(i.height,i.width);!function(e,o,i){i&&(d("#Choco_container_photo, #Choco_content, #Choco_bigImage").stop(!0,!1).css({overflow:"visible"}),d("#Choco_bigImage").animate({height:e+"px",width:o+"px"},r.fadeInImageduration));d("#Choco_container_photo").animate({height:e,width:o},r.fadeInImageduration),d("#Choco_content").animate({height:e,width:o,marginLeft:-o/2,marginTop:-e/2},r.fadeInImageduration,"swing",function(){d("#Choco_bigImage").fadeTo(r.fadeInImageduration,1).height(e).width(o),i||(function(){if(r.linkImages)for(var e=["Choco_right_arrow","Choco_left_arrow"],o=0;o<e.length;o++)hide=!1,"Choco_right_arrow"==e[o]&&r.currentImage==r.lastImage?(hide=!0,d("#"+e[o]).fadeOut(300)):"Choco_left_arrow"==e[o]&&0==r.currentImage&&(hide=!0,d("#"+e[o]).fadeOut(300)),hide||d("#"+e[o]).fadeIn(r.fadeOutImageduration)}(),d("#Choco_container_description").css("visibility","visible"),d("#Choco_close").fadeIn(r.fadeInImageduration))}).css("overflow","visible")}(e.hauteur,e.largeur,o),d("#Choco_loading").stop().fadeOut(r.fadeOutImageduration)},i.src=images[r.setIndex][r.currentImage].adress,r.currentImage!==r.lastImage&&(n=new Image,z=r.currentImage+1,n.src=images[r.setIndex][z].adress),function(){var e=r.currentImage+1,o=r.lastImage+1;d("#Choco_container_title").html(images[r.setIndex][r.currentImage].caption),d("#Choco_container_via").html(r.setTitle+r.separator1+e+r.separator2+o)}()}function t(e){if(!r.linkImages||0==r.currentImage&&-1==e||r.currentImage==r.lastImage&&1==e)return!1;d("#Choco_container_description").css("visibility","hidden"),d("#Choco_bigImage").fadeTo(r.fadeOutImageduration,0,function(){i(r.currentImage+parseInt(e),!1)})}function a(e,o){return void 0===e?o:e}function c(){d("#Choco_overlay").fadeOut(900,function(){d("#Choco_overlay").remove()}),d("#Choco_content").fadeOut(500,function(){d("#Choco_content").remove()}),r.currentImage=0}}}(jQuery);